<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<!-- Meta tags Obrigatórias -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
		<title>Loja App</title>
	</head>
	<body>
	<!-- JavaScript (Opcional) -->
    <!-- jQuery primeiro, depois Popper.js, depois Bootstrap JS -->
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
	
	<script th:inline="javascript">
		
	function deletar(idUsuario){
	    var resultado = confirm("Deseja mesmo deletar o usuario?");
	    
	    var json = {
	    		"idUsuario":idUsuario.value,
	    		"dsUsuario":""
	    }
	    
		if(resultado == true){
			 $.ajax({
	            cache: false,
	            url : 'http://localhost:8081/fabricantes/delete',
	            type: "DELETE",
	            dataType : "json",
	            data : json,
	            success : function(callback){
	            	alert("Deletado com sucesso!");
	            	location.reload();
	            },
	            error : function(){
	            	 alert("Erro");
	            }
	        });	
	     }
    }
    
    function editar2(idUsuario){
	    
	    var json = {
	    		"idUsuario":idUsuario.value,
	    }
	    
		if(resultado == true){
			 $.ajax({
	            cache: false,
	            url : 'http://localhost:8081/fabricantes/editar',
	            type: "GET",
	            dataType : "json",
	            data : json,
	            success : function(callback){
	            	alert("Deletado com sucesso!");
	            	location.reload();
	            },
	            error : function(){
	            	 alert("Erro");
	            }
	        });	
	     }
    }
    
    function editar(param){

		var params = param.split(";");

		var id = params[0];
		
		document.getElementById("idUsuario").value=id;
		document.getElementById("nmUsuario").value=params[1];
		document.getElementById("cnpj").value=params[2];
		document.getElementById("cep").value=params[3];
		document.getElementById("rua").value=params[4];
		document.getElementById("numero").value=params[5];
		document.getElementById("bairro").value=params[6];
		document.getElementById("cidade").value=params[7];
		document.getElementById("complemento").value=params[8];
		document.getElementById("complemento").value=params[8];
		document.getElementById("dddtel1").value=document.getElementById(id+'ddd'+0).value;
		document.getElementById("numtel1").value=document.getElementById(id+'num'+0).value;
		document.getElementById("dddtel2").value=document.getElementById(id+'ddd'+1).value;
		document.getElementById("numtel2").value=document.getElementById(id+'num'+1).value;
		
	}

	function salvar(){

		var id = document.getElementById("idUsuario").value;
		var nmUsuario = document.getElementById("nmUsuario").value;
		var cnpj = document.getElementById("cnpj").value;
		var cep = document.getElementById("cep").value;
		var rua = document.getElementById("rua").value;
		var numero = document.getElementById("numero").value;
		var cidade = document.getElementById("cidade").value;
		var bairro = document.getElementById("bairro").value;
		var complemento = document.getElementById("complemento").value;
		var ddd1 = document.getElementById("dddtel1").value;
		var numtel1 =  document.getElementById("numtel1").value;
		var ddd2 = document.getElementById("dddtel2").value;
		var numtel2 =  document.getElementById("numtel2").value;
		var idtel1 = document.getElementById(id+'id'+0).value;
		var idtel2 = document.getElementById(id+'id'+1).value;

		var json = {
			"idUsuario":id,
    		"nmUsuario":nmUsuario,
    		"endereco": {
	            "dsRua": rua,
	            "endNumero": numero,
	            "endBairro": bairro,
	            "endCidade": cidade,
	            "endComplemento": complemento,
	            "endCep": cep
	        	},
	        "documento":[{
				"dsDocumento":cnpj,
				"tipoDocumento":{
		            "idTpDocumento":3,
		            "dsTpDocumento":"CNPJ"
		         }
				}],
			"telefone":[{
				"idTelefone":idtel1,
				"dddTelefone":ddd1,
				"numTelefone":numtel1
			},
			{
				"idTelefone":idtel2,
				"dddTelefone":ddd2,
				"numTelefone":numtel2
			}]
				
	    };
        console.log(JSON.stringify(json));
        console.log(json);
        
        $.ajax({
			type: "POST",
			contentType : 'application/json; charset=utf-8',
            url : 'http://localhost:8081/fabricantes/save',
            cache: false,
            data : JSON.stringify(json),
            dataType : "json",
            success : function(callback){
            	alert("Salvo com sucesso!");
            	location.reload();
            },
            error : function(){
            	 alert("Erro");
            }
        });	
        
	}
	</script>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<a class="navbar-brand" href="/">Loja App</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#textoNavbar" aria-controls="textoNavbar" aria-expanded="false" aria-label="Alterna navegação">
				<span class="navbar-toggler-icon"></span>
			</button>
		<div class="collapse navbar-collapse" id="textoNavbar">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item">
					<a class="nav-link" href="/">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/vendas">Vendas</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/produtos">Produtos</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/clientes">Clientes</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/funcionarios">Funcionarios</a>
				</li>
				<li class="nav-item active">
					<a class="nav-link" href="/fabricantes">Fornecedores <span class="sr-only">(Página atual)</span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/cargos">Cargos</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="/perfis">Perfis</a>
				</li>
			</ul>
		</div>
	</nav>
	<div class="container-fluid">
		<div class="form-group">
			<div class="row mt-2">
				<div class="col-sm-2">
					<label for="exampleFormControlInput1">ID</label>
					<input type="text" class="form-control" id="idCliente" placeholder="ID">
				</div>
				<div class="col-sm-6">
					<label for="exampleFormControlInput1">Nome</label>
					<input type="text" class="form-control" id="idCliente" placeholder="Nome">
				</div>
				<div class="col-sm-4">
					<label for="exampleFormControlInput1">CNPJ</label>
					<input type="text" class="form-control" id="idCliente" placeholder="Documento">
				</div>
			</div>
			<div class="mt-3" style="text-align: right;">
				<button type="submit" class="btn btn-primary btn-dark" data-toggle="modal" data-target="#modalFabricante">Cadastrar Fabricante</button>
				<button type="submit" class="btn btn-primary btn-dark">Pesquisar</button>
			</div>
		</div>
		<table class="table">
		  <thead>
			<tr>
			  <th scope="col">#</th>
			  <th scope="col">Nome</th>
			  <th scope="col">CNPJ</th>
			  <th scope="col">Endereço</th>
			  <th scope="col"></th>
			</tr>
		  </thead>
		  <tbody>
			<tr th:each="f : ${fabricantes}">
			  <td th:text="${f.idUsuario}"></td>
			  <td th:text="${f.nmUsuario}"></td>
			  <td th:text="${f.numDocumento}"></td>
			  <td th:text="${f.endereco.dsRua} +', ' + ${f.endereco.endNumero} +', ' + ${f.endereco.endBairro} "></td>
			  <td style="text-align: right;">
					<button type="button" th:value="${f.idUsuario} + ';' + ${f.nmUsuario} + ';' +  ${f.numDocumento} + ';' +  ${f.endereco.endCep} 
					+ ';' +  ${f.endereco.dsRua} + ';' + ${f.endereco.endNumero} + ';'  +  ${f.endereco.endBairro} + ';'  +  ${f.endereco.endCidade}
					+ ';' +  ${f.endereco.endComplemento} + ';'"
					onclick="editar(this.value)" class="btn btn-primary btn-dark" data-toggle="modal" data-target="#modalFabricante"><i class="bi bi-pencil-square"></i></button>
					<button class="btn btn-danger"th:value="${f.idUsuario}" onclick="deletar(this)"><i class="bi bi-trash"></i> </button>
				</td>
				<td th:each="tel,row : ${f.telefone}" style="display:none">
					<input type="hidden" th:value="${tel.idTelefone}" th:id="${f.idUsuario}+ 'id'+ ${row.index}"></input>
					<input type="hidden" th:value="${tel.dddTelefone}" th:id="${f.idUsuario}+ 'ddd'+ ${row.index}"></input>
					<input type="hidden" th:value="${tel.numTelefone}" th:id="${f.idUsuario}+ 'num'+ ${row.index}"></input>
				</td>
			</tr>
		  </tbody>
		</table>
		<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" id="modalFabricante"> 
				<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Cadastrar Fabricante</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
							  <span aria-hidden="true">&times;</span>
							</button>
							</div>
						<div class="modal-body modal-lg">
							<form id="form-insercao"  th:object="${usuarioDto}">
							<div class="form-group">
								<div class="row mt-2">
									<div class="col-sm-2">
											<label for="exampleFormControlInput1">ID</label>
											<input type="text" class="form-control" id="idUsuario" th:field="*{idUsuario}" placeholder="ID" readonly>
										</div>
										<div class="col-sm-10">
											<label for="exampleFormControlInput1">Nome Fantasia</label>
											<input type="text" class="form-control" id="nmUsuario"  th:field="*{nmUsuario}"  placeholder="Nome" >
										</div>
									</div>
									<div class="row mt-2">
										<div class="col-6">
											<label for="exampleFormControlInput1">CNPJ</label>
											<input type="text" class="form-control" id="cnpj" placeholder="CNPJ">
										</div>
									</div>
									<label for="exampleFormControlInput1" class="mt-3">Endereco</label>
									<div class="row">
										<div class="col-sm-3">
											<input type="text" class="form-control" id="cep" placeholder="CEP">
										</div>
										<div class="col-sm-7">
											<input type="text" class="form-control" id="rua" placeholder="Rua">
										</div>
										<div class="col-sm-2">
											<input type="text" class="form-control" id="numero" placeholder="N°">
										</div>
										
										<div class="col-sm-3">
											<input type="text" class="form-control" id="bairro" placeholder="Bairro">
										</div>
										<div class="col-sm-3">
											<input type="text" class="form-control" id="cidade" placeholder="Cidade">
										</div>
										<div class="col-sm-6">
											<input type="text" class="form-control" id="complemento" placeholder="Complemento">
										</div>
									</div>
									<label for="exampleFormControlInput1" class="mt-3">Telefone</label>		
									<div class="row">
										<div class="col-3">
											<input type="text" class="form-control" id="dddtel1" placeholder="DDD" >
											
										</div>
										<div class="col-8">
											<input type="text" class="form-control" id="numtel1" placeholder="N° Telefone">
										</div>
									</div>
									<div class="row">
										<div class="col-3">
											<input type="text" class="form-control" id="dddtel2" placeholder="DDD">
										</div>
										<div class="col-8">
											<input type="text" class="form-control" id="numtel2" placeholder="Residencial">
										</div>
									</div>
									<label for="exampleFormControlInput1" class="mt-3"></label>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
									<button type="button" class="btn btn-primary btn-dark" onclick="salvar()">Salvar</button>
								</div>
							</form>
							</div>
						</div>
					</div>
				</div>
			</div>
	</div>
	</body>
</html>